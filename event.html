<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&T | Advanced Event Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { 
            --blue: #0084ff; 
            --blue-hover: #0056b3;
            --bg: #0a0a0a; 
            --card: #141414; 
            --green: #27ae60;
            --red: #c0392b;
            --orange: #f39c12;
        }

        body { 
            background: var(--bg); 
            color: #eee; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 0; 
            margin: 0; 
        }

        .container { max-width: 1000px; margin: 40px auto; padding: 20px; }

        header { text-align: center; margin-bottom: 60px; }
        header h1 { letter-spacing: 12px; font-size: 3rem; margin-bottom: 10px; color: #fff; }
        header p { color: var(--blue); font-weight: bold; text-transform: uppercase; letter-spacing: 2px; }

        /* Grid & Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }
        
        .card { 
            background: var(--card); 
            border: 1px solid #222; 
            border-radius: 12px; 
            padding: 25px; 
            display: flex; 
            flex-direction: column;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        
        .card.confirmed { border-top: 4px solid var(--blue); }
        .card.pending { border-top: 4px solid var(--orange); background: linear-gradient(145deg, #141414 0%, #1a1510 100%); }

        .status-badge { 
            position: absolute; top: 15px; right: 15px; 
            font-size: 10px; padding: 4px 8px; border-radius: 20px; font-weight: bold; 
        }

        h3 { margin: 15px 0 5px 0; font-size: 1.4rem; color: #fff; }
        .date-info { color: var(--blue); font-size: 0.9rem; margin-bottom: 15px; display: flex; align-items: center; gap: 5px; }
        .message-text { font-size: 0.95rem; color: #aaa; font-style: italic; line-height: 1.5; flex-grow: 1; }

        /* Formular */
        .form-section { 
            margin-top: 80px; 
            background: #111; 
            padding: 40px; 
            border-radius: 15px; 
            border: 1px solid #222;
        }
        .form-section h2 { margin-top: 0; border-bottom: 2px solid var(--blue); display: inline-block; padding-bottom: 5px; }
        
        .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        input, textarea { 
            width: 100%; background: #000; border: 1px solid #333; color: #fff; 
            padding: 15px; margin: 10px 0; border-radius: 8px; font-size: 1rem;
            transition: border 0.3s;
        }
        input:focus, textarea:focus { border-color: var(--blue); outline: none; }
        
        .btn-main { 
            background: var(--blue); color: white; border: none; padding: 18px; 
            width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; 
            font-size: 1.1rem; margin-top: 20px; transition: 0.3s;
        }
        .btn-main:hover { background: white; color: black; }

        /* Admin Buttons */
        .admin-bar { 
            display: flex; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px solid #333; 
        }
        .admin-btn { 
            flex: 1; padding: 10px; border: none; border-radius: 6px; 
            color: white; font-weight: bold; cursor: pointer; font-size: 12px;
        }

        .footer { text-align: center; margin-top: 80px; padding: 40px; opacity: 0.4; font-size: 0.8rem; }
        .admin-trigger { cursor: pointer; color: var(--blue); }
        
        @media (max-width: 600px) { .input-group { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <p>TruckersMP VTC Portal</p>
        <h1>EVENT HUB</h1>
    </header>

    <div id="eventList" class="grid">
        </div>

    <div class="form-section">
        <h2>EINLADUNG EINREICHEN</h2>
        <p style="color: #666; margin-bottom: 20px;">Tragt hier euer Event ein. Unser Management wird die Anfrage zeitnah pr√ºfen.</p>
        
        <div class="input-group">
            <input type="text" id="vName" placeholder="VTC Name (z.B. D&T Logistik)">
            <input type="text" id="vDate" placeholder="Datum (z.B. 24.01.2025, 20 Uhr)">
        </div>
        <input type="text" id="vLink" placeholder="TruckersMP Event Link (https://...)">
        <textarea id="vMsg" rows="4" placeholder="Eure Nachricht an uns..."></textarea>
        
        <button class="btn-main" onclick="submitEvent()">EINLADUNG JETZT ABSENDEN</button>
    </div>

    <div class="footer">
        &copy; 2025 D&T Logistik Management | <span class="admin-trigger" onclick="adminLogin()">Admin Login</span>
    </div>
</div>

<script>
    const supabaseUrl = 'https://dihdeuphymaxgxthnjxq.supabase.co';
    const supabaseKey = 'sb_publishable_DOAE2-PtSAC0J2iqFOvfyg_AihL7t74';
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

    let isAdmin = sessionStorage.getItem('dt_admin_auth') === 'true';

    // 1. Daten laden
    async function fetchEvents() {
        const { data, error } = await _supabase
            .from('dt-event-portal')
            .select('*')
            .order('id', { ascending: false });

        if (error) { console.error("Fehler:", error); return; }

        const container = document.getElementById('eventList');
        container.innerHTML = '';

        data.forEach(item => {
            if (!isAdmin && !item.confirmed) return;

            const card = document.createElement('div');
            card.className = `card ${item.confirmed ? 'confirmed' : 'pending'}`;
            
            card.innerHTML = `
                <div class="status-badge" style="background:${item.confirmed ? 'var(--blue)' : 'var(--orange)'}">
                    ${item.confirmed ? 'BEST√ÑTIGT' : 'IN PR√úFUNG'}
                </div>
                <h3>${item.vtc_name}</h3>
                <div class="date-info">üìÖ ${item.event_date}</div>
                <div class="message-text">"${item.message || 'Keine Nachricht hinterlassen.'}"</div>
                ${item.tmp_link ? `<a href="${item.tmp_link}" target="_blank" style="color:var(--blue); text-decoration:none; font-size:12px; margin-top:15px; font-weight:bold;">‚ûú TruckersMP Event Seite</a>` : ''}
            `;

            if (isAdmin) {
                const bar = document.createElement('div');
                bar.className = 'admin-bar';
                
                if (!item.confirmed) {
                    const b1 = document.createElement('button');
                    b1.className = 'admin-btn';
                    b1.style.background = 'var(--green)';
                    b1.innerText = 'FREIGEBEN';
                    b1.onclick = () => updateEvent(item.id, true);
                    bar.appendChild(b1);
                }

                const b2 = document.createElement('button');
                b2.className = 'admin-btn';
                b2.style.background = 'var(--red)';
                b2.innerText = 'L√ñSCHEN';
                b2.onclick = () => removeEvent(item.id);
                bar.appendChild(b2);
                
                card.appendChild(bar);
            }
            container.appendChild(card);
        });
    }

    // 2. Event einreichen + Pop-Up
    async function submitEvent() {
        const n = document.getElementById('vName').value;
        const d = document.getElementById('vDate').value;
        const l = document.getElementById('vLink').value;
        const m = document.getElementById('vMsg').value;

        if(!n || !d || !l) { alert("Bitte f√ºlle alle Pflichtfelder aus."); return; }

        const { error } = await _supabase.from('dt-event-portal').insert([
            { vtc_name: n, event_date: d, tmp_link: l, message: m, confirmed: false }
        ]);

        if (error) {
            alert("Fehler: " + error.message);
        } else {
            // DEIN TEXT HIER
            alert("Wir freuen uns f√ºr eure Event einladung, Slotbuchungen k√∂nnt ihr bei unserem Discord einreiche, wir nehmen aber jeden Slot. Bei keiner R√ºckmeldung nehmen wir am Event teil.");
            location.reload();
        }
    }

    // 3. Admin Login
    window.adminLogin = function() {
        const p = prompt("Management-Passwort eingeben:");
        if (p === "dic2026!") {
            isAdmin = true;
            sessionStorage.setItem('dt_admin_auth', 'true');
            alert("Zugriff gew√§hrt!");
            fetchEvents();
        } else {
            alert("Passwort inkorrekt.");
        }
    };

    // Hilfsfunktionen
    async function updateEvent(id, status) {
        await _supabase.from('dt-event-portal').update({ confirmed: status }).eq('id', id);
        fetchEvents();
    }

    async function removeEvent(id) {
        if(confirm("Event unwiderruflich l√∂schen?")) {
            await _supabase.from('dt-event-portal').delete().eq('id', id);
            fetchEvents();
        }
    }

    fetchEvents();
</script>

</body>
</html>
