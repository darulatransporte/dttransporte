<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>D&T Transporte | Global Event Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --blue: #0084ff; --bg: #0a0a0a; --card: #141414; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; padding: 5vw; }
        
        /* 1. DIE Ã–FFENTLICHE LISTE (FÃ¼r alle sichtbar) */
        .event-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 50px; }
        .event-card { background: var(--card); border: 1px solid #222; padding: 20px; border-radius: 8px; }
        .event-card.confirmed { border-left: 5px solid var(--blue); }
        .tag { font-size: 10px; text-transform: uppercase; background: var(--blue); padding: 4px 8px; border-radius: 3px; }

        /* 2. DAS FORMULAR (FÃ¼r andere Firmen) */
        .submission-form { background: #111; padding: 40px; border-radius: 10px; border: 1px solid #333; }
        input, textarea, select { width: 100%; background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 12px; margin: 10px 0; }
        .submit-btn { background: var(--blue); color: #fff; border: none; padding: 15px 30px; cursor: pointer; font-weight: bold; width: 100%; }

        /* 3. ADMIN BEREICH (Versteckt) */
        #adminArea { display: none; margin-top: 100px; padding: 20px; border: 2px dashed var(--blue); }
        .admin-item { display: flex; justify-content: space-between; background: #222; padding: 15px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1>D&T EVENT HUB</h1>
    <p>Hier siehst du alle Events, an denen D&T Transporte offiziell teilnimmt.</p>

    <div class="event-list" id="publicEvents">
        </div>

    <hr style="border: 0; border-top: 1px solid #333; margin: 50px 0;">

    <div class="submission-form">
        <h2>Event einreichen (FÃ¼r externe VTCs)</h2>
        <p style="color: #666; font-size: 14px;">Deine Einreichung wird vom D&T Management geprÃ¼ft.</p>
        <form id="eventForm">
            <input type="text" id="vtcName" placeholder="Name deiner VTC" required>
            <input type="text" id="eventDate" placeholder="Datum & Uhrzeit (z.B. 20.01. - 20:00 Uhr)" required>
            <input type="url" id="tmpLink" placeholder="TruckersMP Event Link" required>
            <textarea id="eventMsg" placeholder="Kurze Info zum Event / Treffpunkt"></textarea>
            <button type="submit" class="submit-btn">ANFRAGE ABSCHICKEN</button>
        </form>
    </div>

    <p style="text-align: center; margin-top: 50px; opacity: 0.2; cursor: pointer;" onclick="loginAdmin()">Management Login</p>

    <div id="adminArea">
        <h2>Eingegangene Anfragen (Warteschlange)</h2>
        <div id="adminList"></div>
    </div>

    <script>
        // Supabase Verbindung
        const _url = "DEINE_SUPABASE_URL";
        const _key = "DEIN_ANON_KEY";
        const supabase = supabase.createClient(_url, _key);

        // 1. BestÃ¤tigte Events laden (fÃ¼r alle)
        async function loadPublicEvents() {
            const { data } = await supabase.from('events').select('*').eq('confirmed', true);
            const container = document.getElementById('publicEvents');
            container.innerHTML = data.length ? '' : '<p>Aktuell keine bestÃ¤tigten Events.</p>';
            data.forEach(ev => {
                container.innerHTML += `
                    <div class="event-card confirmed">
                        <span class="tag">D&T nimmt teil</span>
                        <h3>${ev.vtc_name}</h3>
                        <p>ðŸ“… ${ev.date}</p>
                        <a href="${ev.link}" target="_blank" style="color:var(--blue)">TruckersMP Link</a>
                    </div>`;
            });
        }

        // 2. Event einreichen (Public)
        document.getElementById('eventForm').onsubmit = async (e) => {
            e.preventDefault();
            const newEvent = {
                vtc_name: document.getElementById('vtcName').value,
                date: document.getElementById('eventDate').value,
                link: document.getElementById('tmpLink').value,
                message: document.getElementById('eventMsg').value,
                confirmed: false // Wichtig: Erstmal unsichtbar!
            };
            await supabase.from('events').insert([newEvent]);
            alert("Anfrage gesendet! Das D&T Management prÃ¼ft deine Einladung.");
            document.getElementById('eventForm').reset();
        };

        // 3. Admin Bereich freischalten
        function loginAdmin() {
            const pw = prompt("Management Passwort:");
            if(pw === "DT2026") {
                document.getElementById('adminArea').style.display = 'block';
                loadAdminList();
            }
        }

        async function loadAdminList() {
            const { data } = await supabase.from('events').select('*').eq('confirmed', false);
            const list = document.getElementById('adminList');
            list.innerHTML = '';
            data.forEach(ev => {
                list.innerHTML += `
                    <div class="admin-item">
                        <span><strong>${ev.vtc_name}</strong> - ${ev.date}</span>
                        <div>
                            <button onclick="approve(${ev.id})" style="background:green; color:white;">Annehmen</button>
                            <button onclick="reject(${ev.id})" style="background:red; color:white;">Ablehnen</button>
                        </div>
                    </div>`;
            });
        }

        async function approve(id) {
            await supabase.from('events').update({ confirmed: true }).eq('id', id);
            loadAdminList(); loadPublicEvents();
        }

        async function reject(id) {
            await supabase.from('events').delete().eq('id', id);
            loadAdminList();
        }

        loadPublicEvents();
    </script>
</body>
</html>
